unit SubTopicOrderEdit;

Umbrella topic;
Topic subTopic;
UmbrellaTopicSetupTable subTopicOrder;

int orderNumber;

string msg;
string nav_return;

bool isEdit;

void init() {

	if (subTopicOrder == null){
		subTopicOrder = UmbrellaTopicSetupTable:new();
		isEdit = false;
		orderNumber = 0;
	} else {
		topic = subTopicOrder.umbrella_UmbrellaUserSetup;
		subTopic = subTopicOrder.topic_UmbrellaUserSetup;
		isEdit = true;
		orderNumber = subTopicOrder.ordernum;
	}

	if (nav_return == null || nav_return == ""){
		nav_return = "nav_topic_link_subtopic_management";
	}
	
}

void resetVars(){
	topic = null;
	subTopic = null;
	subTopicOrder = null;
	msg = "";
	orderNumber = 0;
}

string navigate(){
	resetVars();
	return nav_return;
}

string saveLink(){

	if (topic == null){
		msg = "Please select a Topic";
		Alerter:alert(msg);
		return null;
	}

	if (subTopic == null){
		msg = "Please select a Sub-Topic";
		Alerter:alert(msg);
		return null;
	}

	if (orderNumber == null || orderNumber <= 0){
		msg = "Please enter a SubTopicOrder number which is a positive integer";
   		Alerter:alert(msg);
   		return null;
	}

	if (SubTopicOrderController:getSubTopicOrderNumberForTopicSubTopic(topic, subTopic) != 0 && isEdit == false){
		msg = String:concat("The Topic:", topic.umbrellaID, " and SubTopic: ", subTopic.topicID, " are already associated with SubTopicOrder number: ", orderNumber, " please select unique SubTopicOrder elements");
		Alerter:alert(msg);
		return null;
	}
	
	subTopicOrder.ordernum = orderNumber;
	subTopicOrder.topic_UmbrellaUserSetup = subTopic;
	subTopicOrder.umbrella_UmbrellaUserSetup = topic;
	subTopicOrder.save();

	msg = "Sub-Topic Order Saved";
	Alerter:alert(msg);

	/* Filter SubTopicOrders management table by the topic */
	SubTopicOrderManagement:topicFilter = topic;
	SubTopicOrderManagement:subTopicFilter = null;

	return navigate();
}

