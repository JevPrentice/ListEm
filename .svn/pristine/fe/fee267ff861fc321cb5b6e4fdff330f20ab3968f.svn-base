unit BroadcastChewConfig;

CHEWTEMPLATEMESSAGE templateMessage;

string smsText;

void init(){
	
	if (templateMessage == null ){
		Alerter:alert("This page is not being used correctly");
		return null;
	}

	if (templateMessage == CHEWTEMPLATEMESSAGE.SystemDown){
		smsText = String:concat("Dear CHEW, the system has been down.", "");
	} else if (templateMessage == CHEWTEMPLATEMESSAGE.SystemUp){
		smsText = String:concat("Dear CHEW, the system has come back up.", "");
	} else if (templateMessage == CHEWTEMPLATEMESSAGE.Blank){
		smsText = "";
	}

}

string navigate(string location){
	return location;
}

string back(){
	return navigate("navBroadcastChew");
}

string send(){

	SmartChew chew = SmartChew:user();

	if (chew == null){
		Alerter:alert("No SmartChew Found");
		return null;
	}

	Client c = chew.client;

	if (c == null){
		Alerter:alert("No Client Found");
		return null;
	}

	if (smsText == null || String:length(smsText) <= 0){
		Alerter:alert("Please Enter SMS Text");
		return null;
	}

	Client[] allChews = UserController:getCHEWUsers();

	// smsText = String:concat("group ", selectedGroup.name, " ", smsText);

	// BLUnits:saveAllSMSLogs(c, smsText, "MT");
	BLUnits:fSendDirect(allChews, smsText, "MT");
    // IncomingSMSList:assignIncomingSMS(c, smsText); //updating the incomingSMS table

    string msg = String:concat("Message: - ", smsText, " - sent.");
	Alerter:alert(msg);

	return navigate("navBroadcastMessage");
}
