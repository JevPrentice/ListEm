unit ReportReminder;

/*
*   =================================
*   SmartCHEW reminder
*   =================================
*   AUTHOR: Beyers Nel 21/04/15
*		
*	Reminds the Chew user to view reports monthly
*	Runs everytime a Chew loads the default screen / dashboard
*	Shows a reminder if after the remind date and sets a new date
*
*	TODO
*	
*/

void reportReminderRoutine(SmartChew chew){
	Alerter:alert("Running reminder");

	date dNow = Date:now();
	date dLast = getLastReport(chew);

	if (dLast == null) {
		return;
	}

	if (dNow > dLast) {
		Alerter:alert("Reminder: Check reports");
		incrementDate(chew);

	} else {
		Alerter:alert("Not time for a reminder yet");
	}
}

void incrementDate(SmartChew chew){

	if (chew == null) {
		return;
	}

	chew.reportReminder = Date:addMonths(chew.reportReminder, 1);
}

date getLastReport(SmartChew chew){

	if (chew == null) {
		return null;
	}

	if (chew.reportReminder == null ) {
		chew.reportReminder = Date:now();
		chew.save();
		Alerter:alert("No last date, making new one");
	}
	return chew.reportReminder;
}

void updateDate(SmartChew chew){

	if (chew == null) {
		return;
	}

	chew.reportReminder = Date:now();
}