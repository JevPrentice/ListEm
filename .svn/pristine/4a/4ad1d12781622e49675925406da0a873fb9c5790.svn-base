<?xml version="1.0" encoding="UTF-8"?>
<ui xmlns="http://uiprogram.mezzanine.com/View" 
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://uiprogram.mezzanine.com/View ../../xsd/View.xsd">
    <view label="UserTopicScheduling" unit="UserTopicScheduling" init="init">

        <navigation outcome="GroupTopicScheduling" target="GroupTopicScheduling" />
        <action label="GroupTopicScheduling.title" outcome="GroupTopicScheduling" />

        <submit label="UserTopicScheduling.showAllUsers" action="init"/>
        <submit label="UserTopicScheduling.showUsersForGroup" action="filterUsersForGroup" />
        <submit label="UserTopicScheduling.showUnscheduledUsers" action="showUnscheduledUsers"/>

        <info label="UserTopicScheduling.currentUserFilter">
            <binding variable="clientFilter" />
        </info>

        <select label="UserTopicScheduling.groupFilter">
            <binding variable="selectedGroup"/>
            <collectionSource function="UserGroupController:getAllClientGroups">
                <displayAttribute name="name"/>
            </collectionSource>
        </select>

        <select label="users">
            <binding variable="selectedUser"/>
            <collectionSource variable="users">
                <displayAttribute name="firstName"/>
                <displayAttribute name="surname"/>
                <displayAttribute name="mobileNumber"/>
            </collectionSource>
        </select>

        <select label="topic">
            <binding variable="selectedTopic"/>
            <collectionSource function="TopicController:getAllTopicsNotMarkedNoReport">
                <displayAttribute name="umbrellaID" />
            </collectionSource>
        </select>

        <datefield label="TopicScheduling.startdate">
            <binding variable="dStartDateTime" />
        </datefield>
        
        <checkbox label="TopicScheduling.startNow">
            <binding variable="bIgnoreDefaultTime" />
        </checkbox> 

        <submit label="UserTopicScheduling.scheduleUser" action="scheduleUserOrGroupForTopic"/>
        <submit label="UserTopicScheduling.clearUserSchedule" action="clearUserOrGroupForTopic"/>
        <submit label="UserTopicScheduling.runScheduledStartForUser" action="runScheduledStartForUserOrGroup"/>

        <table title="UserTopicScheduling.table.usersScheduledForSubTopics">
            <collectionSource variable="tusArr"/>
            <column heading="topicUser.topicUserID">
                <attributeName>client_topicUserSetup.firstName</attributeName>
                <attributeName>client_topicUserSetup.surname</attributeName>
                <attributeName>client_topicUserSetup.mobileNumber</attributeName>
            </column>

            <column heading="topic.topicID">
                <attributeName>umbrella_topicUserSetup.umbrellaID</attributeName>
            </column>
                        
            <column heading="sub_topic.subTopicID">
                <attributeName>topic_topicUserSetup.topicID</attributeName>
            </column>
         
             <column heading="topicUser.topicOrder">
                <attributeName>topicOrder</attributeName>
            </column> 
            
            <column heading="topic.active">
                <attributeName>active</attributeName>
            </column> 

            <column heading="sub_topic.subTopicRunType">
                <attributeName>runType</attributeName>
            </column> 

            <column heading="topicUser.topicMinStartDate">
                <attributeName>topicMinStartDate</attributeName>
            </column> 

            <rowAction label="start" action="startUserOnTopic">
                <binding variable="startTus"/>
                <confirm subject="confirm_subject.fStartTopicUserSetup" body="confirm_body.fStartTopicUserSetup"/>
            </rowAction>          
            <rowAction label="end" action="endTopicUserSetup">
                <binding variable="removeTus"/>
                <confirm subject="confirm_subject.deleteTopicUserSetup" body="confirm_body.deleteTopicUserSetup"/>
            </rowAction>
        </table>

        <submit label="TopicScheduling.showAllTus" action="showAllTus"/>
        <submit label="TopicScheduling.showTusForGroup" action="showTusForGroup"/>
        <submit label="TopicScheduling.showTusForUser" action="showTusForUser"/>

    </view>
</ui>

