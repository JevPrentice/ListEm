unit SequenceEdit;

Sequence sequence;
Topic subTopic;

SequenceOrder sequenceOrder;

string sequenceID;

string msg;
string nav_return;

bool isEdit;

void init() {

	if (sequence == null){
		sequence = Sequence:new();
		isEdit = false;
		sequenceID = null;

		if (subTopic != null){
			sequenceID = subTopic.topicID;
		}
		
	} else {
		isEdit = true;
		sequenceID = sequence.sequenceID;
	}

	if (nav_return == null){
		nav_return = "nav_sequence_management";
	}
	
}

void resetVars(){
	msg = "";
	subTopic = null;
	sequence = null;
	sequenceOrder = null;
	sequenceID = null;
}

string navigate(){
	resetVars();
	return nav_return;
}

bool saveSequence(){

	if (sequenceID == null){
		msg = "Please enter a Sequence ID";
		Alerter:alertError(msg);
		return false;
	}

	if (String:length(sequenceID) <= 0){
		msg = "Please enter a Sequence ID";
		Alerter:alertError(msg);
		return false;
	}

	sequenceID = String:upper(sequenceID);

	Topic[] subTopics = SubTopicController:getSubTopicsForTopicID(sequenceID);
	if (subTopics != null){
		if (subTopics.length() > 0){
			msg = "Sequence ID is the same as a SubTopic ID, Please ensure that the ID is unique";
			Alerter:alertError(msg);
			return false;
		}
	}

	Sequence[] sequences = SequenceController:getSequencesForSequenceID(sequenceID);
	if (sequences.length() >= 1){

		if (isEdit == true){
			if (sequence.sequenceID != sequenceID){
				msg = String:concat("Sequence ID ", sequenceID," already exists, please ensure that the SequenceID is unique, sequence NOT updated" );
				Alerter:alertError(msg);
				return null;
			}
		} else {
			msg = String:concat("Sequence ID ", sequenceID," already exists, please ensure that the SequenceID is unique, sequence NOT saved");
			Alerter:alertError(msg);
			return null;
		}
	}

	sequence.sequenceID = sequenceID;
	sequence.save();

	msg = String:concat("Sequence with ID:", sequence.sequenceID, " Saved");
	Alerter:alert(msg);

	return true;
}

string saveSequenceButton() {
	if (saveSequence() != true){
		return null;
	}
	return navigate();
}

string saveSequenceNavSequenceOrderEdit(){
	if (saveSequence() != true){
		return null;
	}

	nav_return = "nav_sequence_order_edit";
	SequenceOrderEdit:sequenceOrder = sequenceOrder;
	SequenceOrderEdit:subTopic = subTopic;
	SequenceOrderEdit:sequence = sequence;
	return navigate();
}
