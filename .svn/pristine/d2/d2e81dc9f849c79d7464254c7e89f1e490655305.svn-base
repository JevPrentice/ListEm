unit SendCustomSMS;

Client uClient;

string smsDirection;
string smsText;

void init() {
    smsText = "";
}

string back(){
	return "nav_user_management";
}

string sendCustomSms(){

    if (smsDirection == "Inbound SMS"){
        return sendAdHocSMSIN();
    } 
    return sendAdHocSMSOUT();
}

string sendAdHocSMSIN(){
    
    if(uClient == null){
        Alerter:alert("Cant Send SMS, no User found");
        return;
    } 

    if (uClient.mobileNumber == null){
        Alerter:alert("Cant Send SMS, no User number found");
        return;
    }

    if(smsText == null){
         Alerter:alert("Cant Send SMS, no SMS content");
         return;
    }

    if (String:length(smsText) <= 0){
        Alerter:alert("Cant Send SMS, no SMS content");
        return;
    }

    if(smsText=="*"){ 
        smsText = "*done*ALL"; 
    }
    
    RecievedSMSHandler:receiveIncomingSms(uClient.mobileNumber, smsText);

    Alerter:alert(String:concat("Incoming Message Recieved From: ", uClient.mobileNumber));

    return back();
}

string sendAdHocSMSOUT(){
    // Logger:log(String:concat("Outgoing Message Sent To: ", uClient.mobileNumber));

    if(uClient != null && smsText != null && smsText != ""){
        BLUnits:SendSMSToClient(uClient, smsText);
    }

    Alerter:alert(String:concat("Outgoing Message Sent To: ", uClient.mobileNumber));
    return back();
}