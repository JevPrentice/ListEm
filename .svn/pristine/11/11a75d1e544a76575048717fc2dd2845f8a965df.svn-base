unit GroupBulkUpload;

Client selected_chew;

string message;
string csv_template_header;
string csv_template_content;

UploadedFile uploadedFile;

void init() {
	uploadedFile = UploadedFile:new();
	message = "";

	csv_template_header = "idd,name"; 
	csv_template_content = "TG1,test_group_one"; 

}

string back(){
	return "nav_group_management";
}

string processCSV(){

	if(selected_chew == null){
		message = "Please specify the groups CHEW";
		Alerter:alert(message);
		return null;
	}

	ClientGroupCSV[] csv;
    csv = ClientGroupCSV:fromCsv(uploadedFile.data);
    
	for (int i = 0; i < csv.length(); i++){
		
		ClientGroupCSV csv_entry = csv.get(i);

		ClientGroup group = ClientGroup:new();
		group.idd = csv_entry.idd;
		group.name = csv_entry.name;

		group.client_chews = selected_chew;

		group.save();

	}

	message = "CSV Imported Successfully";
	Alerter:alert(message);
	return back();
}