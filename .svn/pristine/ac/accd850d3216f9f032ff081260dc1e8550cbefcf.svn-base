/* Updates from HELP VERSION HELP-2015-04-10  */

set search_path to help_002;

--Original release: 04-10
begin;
ALTER TABLE umbrellappe ADD COLUMN quizpercentage integer;
ALTER TABLE umbrellappe ADD COLUMN chatscoreadjusted integer;
ALTER TABLE umbrellappe ADD COLUMN practicumpercentage integer;
ALTER TABLE umbrellappe ADD COLUMN practicumtotalscoreachieved integer;
ALTER TABLE umbrellappe ADD COLUMN durationhours integer;
ALTER TABLE groupumbrellappe ADD COLUMN totalUsers integer;
ALTER TABLE topicppe ADD COLUMN umbrella_topicppe_fk uuid REFERENCES umbrella(_id_);
ALTER TABLE topichistorylog ADD COLUMN umbrella_topichistorylog_fk uuid REFERENCES umbrella(_id_);
end;

--Original release: 04-14
begin;
ALTER TABLE client ADD COLUMN isActive boolean;
UPDATE client SET isactive = true;
end;

--Original release: 04-14
begin;
ALTER TABLE client ADD COLUMN group_fk UUID REFERENCES clientgroup(_id_);
UPDATE client SET group_fk = client_chws_fk;
end;

--Original release: 04-14
begin;
--NOTE, this will fail if views are still referancing client_chws_fk
ALTER TABLE client DROP COLUMN client_chws_fk;
end;

--Original release: 04-14 #373
CREATE TABLE admin
(
  _id_ uuid NOT NULL,
  _tstamp_ timestamp without time zone NOT NULL,
  firstnames text NOT NULL,
  surname text NOT NULL,
  mobilenumber text NOT NULL,
  _firstnames text,
  _nickname text,
  _surname text,
  _locale text,
  _timezone text,
  CONSTRAINT admin_pkey PRIMARY KEY (_id_)
)
WITH (
  OIDS=FALSE
);
ALTER TABLE admin
  OWNER TO helium;
GRANT ALL ON TABLE admin TO helium;
GRANT SELECT ON TABLE admin TO reporter_help_002;

--Original release: 04-15 #382
begin;

UPDATE umbrellappe SET quizpercentage = 0 WHERE quizpercentage is null;
UPDATE umbrellappe SET chatscoreadjusted = 0 WHERE chatscoreadjusted is null;
UPDATE umbrellappe SET practicumpercentage = 0 WHERE practicumpercentage is null;
UPDATE umbrellappe SET practicumtotalscoreachieved = 0 WHERE practicumtotalscoreachieved is null;
UPDATE umbrellappe SET durationhours = 0 WHERE durationhours is null;

UPDATE groupumbrellappe SET totalUsers = 0 WHERE totalUsers is null;

end;

